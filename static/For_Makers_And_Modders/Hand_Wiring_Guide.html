<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
    <title>Hand Wiring Guide - QMK Firmware</title>
    <meta name="description" content="Keyboard controller firmware for Atmel AVR and ARM USB families">
    <meta name="author" content="QMK Community">
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <link rel="icon" href="../themes/daux/img/favicon-navy.png" type="image/x-icon">

    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font -->
    
    <!-- CSS -->
    <link href='../themes/daux/css/theme-navy.min.css' rel='stylesheet' type='text/css'>
            <!-- Tipue Search -->
        <link href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    <!--[if lt IE 9]>
    <script src="../themes/daux/js/html5shiv-3.7.3.min.js"></script>
    <![endif]-->
</head>
<body class=" ">
    <div class="Columns content">
    <aside class="Columns__left Collapsible">
        <button type="button" class="Button Collapsible__trigger">
            <span class="Collapsible__trigger__bar"></span>
            <span class="Collapsible__trigger__bar"></span>
            <span class="Collapsible__trigger__bar"></span>
        </button>

        <a class="Brand" href="../index.html">QMK Firmware</a>

    <div class="Search">
        <svg class="Search__icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 451 451">
            <path d="M447.05 428l-109.6-109.6c29.4-33.8 47.2-77.9 47.2-126.1C384.65 86.2 298.35 0 192.35 0 86.25 0 .05 86.3.05 192.3s86.3 192.3 192.3 192.3c48.2 0 92.3-17.8 126.1-47.2L428.05 447c2.6 2.6 6.1 4 9.5 4s6.9-1.3 9.5-4c5.2-5.2 5.2-13.8 0-19zM26.95 192.3c0-91.2 74.2-165.3 165.3-165.3 91.2 0 165.3 74.2 165.3 165.3s-74.1 165.4-165.3 165.4c-91.1 0-165.3-74.2-165.3-165.4z"/>
        </svg>
        <input type="search" id="tipue_search_input" class="Search__field" placeholder="Search..." autocomplete="on"
               results=25 autosave=text_search>
    </div>

        <div class="Collapsible__content">
            <!-- Navigation -->
            <ul class='Nav'><li class='Nav__item  has-children'><a href="../Getting_Started/index.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Getting Started</a><ul class='Nav'><li class='Nav__item  has-children'><a href="../Getting_Started/Install_Build_Tools/index.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Install Build Tools</a><ul class='Nav'><li class='Nav__item '><a href="../Getting_Started/Install_Build_Tools/Vagrant.html">Vagrant</a></li></ul></li><li class='Nav__item '><a href="../Getting_Started/Build_Compile_Instructions.html">Build Compile Instructions</a></li><li class='Nav__item '><a href="../Getting_Started/Flashing_Firmware.html">Flashing Firmware</a></li><li class='Nav__item '><a href="../Getting_Started/Contributing.html">Contributing</a></li><li class='Nav__item '><a href="../Getting_Started/How_to_Use_GitHub.html">How to Use GitHub</a></li><li class='Nav__item '><a href="../Getting_Started/Getting_Help.html">Getting Help</a></li></ul></li><li class='Nav__item  has-children'><a href="../Complete_Newbs_Guide/index.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Complete Newbs Guide</a><ul class='Nav'><li class='Nav__item '><a href="../Complete_Newbs_Guide/Complete_Newbie's_Guide.html">Complete Newbie's Guide</a></li><li class='Nav__item '><a href="../Complete_Newbs_Guide/Building_Your_First_Firmware.html">Building Your First Firmware</a></li><li class='Nav__item '><a href="../Complete_Newbs_Guide/Flashing_Firmware.html">Flashing Firmware</a></li><li class='Nav__item '><a href="../Complete_Newbs_Guide/Testing_and_Debugging.html">Testing and Debugging</a></li></ul></li><li class='Nav__item  has-children'><a href="../FAQ/index.html" class="folder"><i class="Nav__arrow">&nbsp;</i>FAQ</a><ul class='Nav'><li class='Nav__item '><a href="../FAQ/General_FAQ.html">General FAQ</a></li><li class='Nav__item '><a href="../FAQ/Build_Compile_QMK.html">Build Compile QMK</a></li><li class='Nav__item '><a href="../FAQ/Debugging_and_Troubleshooting.html">Debugging and Troubleshooting</a></li><li class='Nav__item '><a href="../FAQ/Keymaps.html">Keymaps</a></li></ul></li><li class='Nav__item  has-children'><a href="../Hardware/index.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Hardware</a><ul class='Nav'><li class='Nav__item '><a href="../Hardware/AVR_Processors.html">AVR Processors</a></li><li class='Nav__item '><a href="../Hardware/Drivers.html">Drivers</a></li></ul></li><li class='Nav__item  has-children'><a href="../Features/index.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Features</a><ul class='Nav'><li class='Nav__item '><a href="../Features/Advanced_Keycodes.html">Advanced Keycodes</a></li><li class='Nav__item '><a href="../Features/Audio.html">Audio</a></li><li class='Nav__item '><a href="../Features/Auto_Shift.html">Auto Shift</a></li><li class='Nav__item '><a href="../Features/Backlight.html">Backlight</a></li><li class='Nav__item '><a href="../Features/Bluetooth.html">Bluetooth</a></li><li class='Nav__item '><a href="../Features/Bootmagic.html">Bootmagic</a></li><li class='Nav__item '><a href="../Features/Command.html">Command</a></li><li class='Nav__item '><a href="../Features/Dynamic_Macros.html">Dynamic Macros</a></li><li class='Nav__item '><a href="../Features/Grave_Escape.html">Grave Escape</a></li><li class='Nav__item '><a href="../Features/Key_Lock.html">Key Lock</a></li><li class='Nav__item '><a href="../Features/Layouts.html">Layouts</a></li><li class='Nav__item '><a href="../Features/Leader_Key.html">Leader Key</a></li><li class='Nav__item '><a href="../Features/Macros.html">Macros</a></li><li class='Nav__item '><a href="../Features/Mouse_Keys.html">Mouse Keys</a></li><li class='Nav__item '><a href="../Features/Pointing_Device.html">Pointing Device</a></li><li class='Nav__item '><a href="../Features/PS_2_Mouse.html">PS 2 Mouse</a></li><li class='Nav__item '><a href="../Features/RGB_Lighting.html">RGB Lighting</a></li><li class='Nav__item '><a href="../Features/Space_Cadet_Shift.html">Space Cadet Shift</a></li><li class='Nav__item '><a href="../Features/Space_Cadet_Shift_Enter.html">Space Cadet Shift Enter</a></li><li class='Nav__item '><a href="../Features/Stenography.html">Stenography</a></li><li class='Nav__item '><a href="../Features/Swap_Hands.html">Swap Hands</a></li><li class='Nav__item '><a href="../Features/Tap_Dance.html">Tap Dance</a></li><li class='Nav__item '><a href="../Features/Terminal.html">Terminal</a></li><li class='Nav__item '><a href="../Features/Thermal_Printer.html">Thermal Printer</a></li><li class='Nav__item '><a href="../Features/Unicode.html">Unicode</a></li><li class='Nav__item '><a href="../Features/Userspace.html">Userspace</a></li></ul></li><li class='Nav__item  has-children'><a href="../Keycodes/index.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Keycodes</a><ul class='Nav'><li class='Nav__item '><a href="../Keycodes/Advanced_Keycodes.html">Advanced Keycodes</a></li><li class='Nav__item '><a href="../Keycodes/Backlight.html">Backlight</a></li><li class='Nav__item '><a href="../Keycodes/Basic.html">Basic</a></li><li class='Nav__item '><a href="../Keycodes/Bluetooth.html">Bluetooth</a></li><li class='Nav__item '><a href="../Keycodes/Bootmagic.html">Bootmagic</a></li><li class='Nav__item '><a href="../Keycodes/Quantum_Keycodes.html">Quantum Keycodes</a></li><li class='Nav__item '><a href="../Keycodes/RGB_Lighting.html">RGB Lighting</a></li><li class='Nav__item '><a href="../Keycodes/Stenography.html">Stenography</a></li><li class='Nav__item '><a href="../Keycodes/Thermal_Printer.html">Thermal Printer</a></li><li class='Nav__item '><a href="../Keycodes/US_ANSI_Shifted_keys.html">US ANSI Shifted keys</a></li></ul></li><li class='Nav__item  has-children'><a href="../Reference/index.html" class="folder"><i class="Nav__arrow">&nbsp;</i>Reference</a><ul class='Nav'><li class='Nav__item '><a href="../Reference/Keyboard_Guidelines.html">Keyboard Guidelines</a></li><li class='Nav__item '><a href="../Reference/Compatable_Microcontrollers.html">Compatable Microcontrollers</a></li><li class='Nav__item '><a href="../Reference/Config_Options.html">Config Options</a></li><li class='Nav__item '><a href="../Reference/Custom_Code.html">Custom Code</a></li><li class='Nav__item '><a href="../Reference/Documentation_Best_Practices.html">Documentation Best Practices</a></li><li class='Nav__item '><a href="../Reference/Documentation_Templates.html">Documentation Templates</a></li><li class='Nav__item '><a href="../Reference/Glossary.html">Glossary</a></li><li class='Nav__item '><a href="../Reference/Keymap_Overview.html">Keymap Overview</a></li><li class='Nav__item '><a href="../Reference/Unit_Testing.html">Unit Testing</a></li></ul></li><li class='Nav__item Nav__item--open has-children'><a href="../For_Makers_And_Modders/index.html" class="folder"><i class="Nav__arrow">&nbsp;</i>For Makers And Modders</a><ul class='Nav'><li class='Nav__item Nav__item--active'><a href="../For_Makers_And_Modders/Hand_Wiring_Guide.html">Hand Wiring Guide</a></li><li class='Nav__item '><a href="../For_Makers_And_Modders/ISP_Flashing_Guide.html">ISP Flashing Guide</a></li></ul></li><li class='Nav__item  has-children'><a href="../IDEs/index.html" class="folder"><i class="Nav__arrow">&nbsp;</i>IDEs</a><ul class='Nav'><li class='Nav__item '><a href="../IDEs/Eclipse.html">Eclipse</a></li></ul></li><li class='Nav__item  has-children'><a href="../For_a_Deeper_Understanding/index.html" class="folder"><i class="Nav__arrow">&nbsp;</i>For a Deeper Understanding</a><ul class='Nav'><li class='Nav__item '><a href="../For_a_Deeper_Understanding/How_Keyboards_Work.html">How Keyboards Work</a></li><li class='Nav__item '><a href="../For_a_Deeper_Understanding/Understanding_QMK.html">Understanding QMK</a></li></ul></li></ul>

            <div class="Links">
                            </div>

            
                
                        </div>
    </aside>
    <div class="Columns__right Columns__right--full">
        <div class="Columns__right__content">
            <div class="doc_content">
                <article class="Page">

    <div class="Page__header">
        <h1><a href="../For_Makers_And_Modders/index.html">For Makers And Modders</a> <svg class="Page__header--separator" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 477.175 477.175"><path d="M360.73 229.075l-225.1-225.1c-5.3-5.3-13.8-5.3-19.1 0s-5.3 13.8 0 19.1l215.5 215.5-215.5 215.5c-5.3 5.3-5.3 13.8 0 19.1 2.6 2.6 6.1 4 9.5 4 3.4 0 6.9-1.3 9.5-4l225.1-225.1c5.3-5.2 5.3-13.8.1-19z"/></svg> <a href="../For_Makers_And_Modders/Hand_Wiring_Guide.html">Hand Wiring Guide</a></h1>
                        <span class="EditOn">
            <a href="https://github.com/qmk/qmk_firmware/blob/master/docs/08_For_Makers_And_Modders/Hand_Wiring_Guide.md" target="_blank">
                Edit on GitHub            </a>
        </span>
            </div>

    <div class="s-content">
        <ul class="TableOfContents">
<li>
<p><a href="#page_Quantum-Hand-Wiring-Guide">Quantum Hand-Wiring Guide</a></p>
<ul class="TableOfContents">
<li>
<p><a href="#page_How-the-Matrix-Works-Why-We-Need-Diodes">How the Matrix Works (Why We Need Diodes)</a></p>
</li>
</ul>
</li>
<li>
<p><a href="#page_The-Actual-Hand-Wiring">The Actual Hand-Wiring</a></p>
<ul class="TableOfContents">
<li>
<p><a href="#page_Getting-Things-in-Place">Getting Things in Place</a></p>
</li>
<li>
<p><a href="#page_Preparing-the-Diodes">Preparing the Diodes</a></p>
</li>
<li>
<p><a href="#page_Soldering-the-Diodes">Soldering the Diodes</a></p>
</li>
<li>
<p><a href="#page_Soldering-the-Columns">Soldering the Columns</a></p>
</li>
<li>
<p><a href="#page_Wiring-Things-to-the-Teensy">Wiring Things to the Teensy</a></p>
</li>
</ul>
</li>
<li>
<p><a href="#page_Getting-Some-Basic-Firmware-Set-Up">Getting Some Basic Firmware Set Up</a></p>
<ul class="TableOfContents">
<li>
<p><a href="#page_section_10"><code>config.h</code></a></p>
</li>
<li>
<p><a href="#page_section_11"><code>&lt;project_name&gt;.h</code></a></p>
</li>
<li>
<p><a href="#page_section_12"><code>keymaps/&lt;variant&gt;/default.c</code></a></p>
</li>
<li>
<p><a href="#page_Compiling-Your-Firmware">Compiling Your Firmware</a></p>
</li>
<li>
<p><a href="#page_Testing-Your-Firmware">Testing Your Firmware</a></p>
</li>
</ul>
</li>
<li>
<p><a href="#page_Securing-the-Teensy-Finishing-Your-Hardware-Getting-Fancier-Firmware">Securing the Teensy, Finishing Your Hardware, Getting Fancier Firmware</a></p>
</li>
</ul>
<h1 id="page_Quantum-Hand-Wiring-Guide">Quantum Hand-Wiring Guide</h1>
<p>Parts list:</p>
<ul>
<li>
<em>x</em> keyswitches (MX, Matias, Gateron, etc)</li>
<li>
<em>x</em> diodes</li>
<li>Keyboard plate (metal, plastic, cardboard, etc)</li>
<li>Wire (strained for wiring to the Teensy, anything for the rows/columns)</li>
<li>Soldering iron set at 600ºF or 315ºC (if temperature-controlled)</li>
<li>Rosin-cored solder (leaded or lead-free)</li>
<li>Adequate ventilation/a fan</li>
<li>Tweezers (optional)</li>
<li>Wire cutters/snippers</li>
</ul>
<h2 id="page_How-the-Matrix-Works-Why-We-Need-Diodes">How the Matrix Works (Why We Need Diodes)</h2>
<p>The microcontroller (in this case, the Teensy 2.0) will be setup up via the firmware to send a logical 1 to the columns, one at a time, and read from the rows, all at once - this process is called matrix scanning. The matrix is a bunch of open switches that, by default, don't allow any current to pass through - the firmware will read this as no keys being pressed. As soon as you press one key down, the logical 1 that was coming from the column the keyswitch is attached to gets passed through the switch and to the corresponding row - check out the following 2x2 example:</p>
<pre><code>    Column 0 being scanned     Column 1 being scanned
              x                                   x
             col0     col1              col0     col1
              |        |                 |        |
    row0 ---(key0)---(key1)    row0 ---(key0)---(key1)
              |        |                 |        |
    row1 ---(key2)---(key3)    row1 ---(key2)---(key3)
</code></pre>
<p>The <code>x</code> represents that the column/row associated has a value of 1, or is HIGH. Here, we see that no keys are being pressed, so no rows get an <code>x</code>. For one keyswitch, keep in mind that one side of the contacts is connected to its row, and the other, its column.</p>
<p>When we press <code>key0</code>, <code>col0</code> gets connected to <code>row0</code>, so the values that the firmware receives for that row is <code>0b01</code> (the <code>0b</code> here means that this is a bit value, meaning all of the following digits are bits - 0 or 1 - and represent the keys in that column). We'll use this notation to show when a keyswitch has been pressed, to show that the column and row are being connected:</p>
<pre><code>    Column 0 being scanned     Column 1 being scanned
              x                                   x
             col0     col1              col0     col1
              |        |                 |        |
  x row0 ---(-+-0)---(key1)    row0 ---(-+-0)---(key1)
              |        |                 |        |
    row1 ---(key2)---(key3)    row1 ---(key2)---(key3)
</code></pre>
<p>We can now see that <code>row0</code> has an <code>x</code>, so has the value of 1. As a whole, the data the firmware receives when <code>key0</code> is pressed is</p>
<pre><code>col0: 0b01
col1: 0b00
        │└row0
        └row1
</code></pre>
<p>A problem arises when you start pressing more than one key at a time. Looking at our matrix again, it should become pretty obvious:</p>
<pre><code>    Column 0 being scanned     Column 1 being scanned
              x                                   x
             col0     col1              col0     col1
              |        |                 |        |
  x row0 ---(-+-0)---(-+-1)  x row0 ---(-+-0)---(-+-1)
              |        |                 |        |
  x row1 ---(key2)---(-+-3)  x row1 ---(key2)---(-+-3)

  Remember that this ^ is still connected to row1
</code></pre>
<p>The data we get from that is:</p>
<pre><code>col0: 0b11
col1: 0b11
        │└row0
        └row1
</code></pre>
<p>Which isn't accurate, since we only have 3 keys pressed down, not all 4. This behavior is called ghosting, and only happens in odd scenarios like this, but can be much more common on a bigger keyboard. The way we can get around this is by placing a diode after the keyswitch, but before it connects to its row. A diode only allows current to pass through one way, which will protect our other columns/rows from being activated in the previous example. We'll represent a dioded matrix like this;</p>
<pre><code>    Column 0 being scanned     Column 1 being scanned
                x                                   x
              col0      col1              col0     col1
                │        │                 |        │
             (key0)   (key1)            (key0)   (key1)
              ! │      ! │               ! |      ! │
    row0 ─────┴────────┘ │     row0 ─────┴────────┘ │
                │        │                 |        │
             (key2)   (key3)            (key2)   (key3)
              !        !                 !        !
    row1 ─────┴────────┘       row1 ─────┴────────┘
</code></pre>
<p>In practical applications, the black line of the diode will be placed facing the row, and away from the keyswitch - the <code>!</code> in this case is the diode, where the gap represents the black line. A good way to remember this is to think of this symbol: <code>&gt;|</code></p>
<p>Now when we press the three keys, invoking what would be a ghosting scenario:</p>
<pre><code>    Column 0 being scanned     Column 1 being scanned
                x                                   x
              col0      col1              col0     col1
                │        │                 │        │
             (┌─┤0)   (┌─┤1)            (┌─┤0)   (┌─┤1)
              ! │      ! │               ! │      ! │
  x row0 ─────┴────────┘ │   x row0 ─────┴────────┘ │
                │        │                 │        │
             (key2)   (┌─┘3)            (key2)   (┌─┘3)
              !        !                 !        !
    row1 ─────┴────────┘     x row1 ─────┴────────┘
</code></pre>
<p>Things act as they should! Which will get us the following data:</p>
<pre><code>col0: 0b01
col1: 0b11
        │└row0
        └row1
</code></pre>
<p>The firmware can then use this correct data to detect what it should do, and eventually, what signals it needs to send to the OS.</p>
<h1 id="page_The-Actual-Hand-Wiring">The Actual Hand-Wiring</h1>
<h2 id="page_Getting-Things-in-Place">Getting Things in Place</h2>
<p>When starting this, you should have all of your stabilisers and keyswitches already installed (and optionally keycaps). If you're using a Cherry-type stabiliser (plate-mounted only, obviously), you'll need to install that before your keyswitches. If you're using Costar ones, you can installed them afterwards.</p>
<p>To make things easier on yourself, make sure all of the keyswitches are oriented the same way (if they can be - not all layouts support this). Despite this, it's important to remember that the contacts on the keyswitches are completely symmetrical. We'll be using the keyswitch's left side contact for wiring the rows, and the right side one for wiring the columns.</p>
<p>Get your soldering iron heated-up and collect the rest of the materials from the part list at the beginning of the guide. Place your keyboard so that the bottoms of the keyswitches are accessible - it may be a good idea to place it on a cloth to protect your keyswitches/keycaps.</p>
<p>Before continuing, plan out where you're going to place your Teensy. If you're working with a board that has a large (6.25u) spacebar, it may be a good idea to place it in-between switches against the plate. Otherwise, you may want to trim some of the leads on the keyswitches where you plan on putting it - this will make it a little harder to solder the wire/diodes, but give you more room to place the Teensy.</p>
<h2 id="page_Preparing-the-Diodes">Preparing the Diodes</h2>
<p>It's a little easier to solder the diodes in place if you bend them at a 90º angle immediately after the black line - this will help to make sure you put them on the right way (direction matters), and in the correct position. The diodes will look like this when bent (with longer leads):</p>
<pre><code>       ┌─────┬─┐
    ───┤     │ ├─┐
       └─────┴─┘ │
                 │
</code></pre>
<p>We'll be using the long lead at the bent end to connect it to the elbow (bent part) of the next diode, creating the row.</p>
<h2 id="page_Soldering-the-Diodes">Soldering the Diodes</h2>
<p>Starting at the top-left switch, place the diode (with tweezers if you have them) on the switch so that the diode itself is vertically aligned, and the black line is facing toward you. The straight end of the diode should be touching the left contact on the switch, and the bent end should be facing to the right and resting on the switch there, like this:</p>
<pre><code>     │o
    ┌┴┐         o
    │ │    O
    ├─┤
    └┬┘
     └─────────────
</code></pre>
<p>Letting the diode rest, grab your solder, and touch both it and the soldering iron to the left contact at the same time - the rosin in the solder should make it easy for the solder to flow over both the diode and the keyswitch contact. The diode may move a little, and if it does, carefully position it back it place by grabbing the bent end of the diode - the other end will become hot very quickly. If you find that it's moving too much, using needle-nose pliers of some sort may help to keep the diode still when soldering.</p>
<p>The smoke that the rosin releases is harmful, so be careful not to breath it or get it in your eyes/face.</p>
<p>After soldering things in place, it may be helpful to blow on the joint to push the smoke away from your face, and cool the solder quicker. You should see the solder develop a matte (not shiny) surface as it solidifies. Keep in mind that it will still be very hot afterwards, and will take a couple minutes to be cool to touch. Blow on it will accelerate this process.</p>
<p>When the first diode is complete, the next one will need to be soldered to both the keyswitch, and the previous diode at the new elbow. That will look something like this:</p>
<pre><code>     │o               │o
    ┌┴┐         o    ┌┴┐         o
    │ │    O         │ │    O
    ├─┤              ├─┤
    └┬┘              └┬┘
     └────────────────┴─────────────
</code></pre>
<p>After completing a row, use the wire cutters to trim the excess wire from the tops of the diodes, and from the right side on the final switch. This process will need to completed for each row you have.</p>
<p>When all of the diodes are completely soldered, it's a good idea to quickly inspect each one to ensure that your solder joints are solid and sturdy - repairing things after this is possible, but more difficult.</p>
<h2 id="page_Soldering-the-Columns">Soldering the Columns</h2>
<p>You'll have some options in the next process - it's a good idea to insulate the column wires (since the diodes aren't), but if you're careful enough, you can use exposed wires for the columns - it's not recommended, though. If you're using single-cored wire, stripping the plastic off of the whole wire and feeding it back on is probably the best option, but can be difficult depending on the size and materials. You'll want to leave parts of the wire exposed where you're going to be solder it onto the keyswitch.</p>
<p>If you're using stranded wire, it's probably easiest to just use a lot of small wires to connect each keyswitch along the column. It's possible to use one and melt through the insulation, but this isn't recommended, will produce even more harmful fumes, and can ruin your soldering iron.</p>
<p>Before beginning to solder, it helps to have your wire pre-bent (if using single-cored), or at least have an idea of how you're going to route the column (especially if you're making a staggered board). Where you go in particular doesn't matter too much, as we'll be basing our keymap definitions on how it was wired - just make sure every key in a particular row is in a unique column, and that they're in order from left to right.</p>
<p>If you're not using any insulation, you can try to keep the column wires elevated, and solder them near the tips of the keyswitch contacts - if the wires are sturdy enough, they won't short out to the row wiring an diodes.</p>
<h2 id="page_Wiring-Things-to-the-Teensy">Wiring Things to the Teensy</h2>
<p>Now that the matrix itself is complete, it's time to connect what you've done to the Teensy. You'll be needing the number of pins equal to your number of columns + your number of rows. There are some pins on the Teensy that are special, like D6 (the LED on the chip), or some of the UART, SPI, I2C, or PWM channels, but only avoid those if you're planning something in addition to a keyboard. If you're unsure about wanting to add something later, you should have enough pins in total to avoid a couple.</p>
<p>The pins you'll absolutely have to avoid are: GND, VCC, AREF, and RST - all the others are usable and accessible in the firmware.</p>
<p>Place the Teensy where you plan to put it - you'll have to cut wires to length in the next step, and you'll want to make sure they reach.</p>
<p>Starting with the first column on the right side, measure out how much wire you'll need to connect it to the first pin on the Teensy - it helps to pick a side that you'll be able to work down, to keep the wires from overlapping too much. It may help to leave a little bit of slack so things aren't too tight. Cut the piece of wire, and solder it to the Teensy, and then the column - you can solder it anywhere along the column, but it may be easiest at the keyswitch. Just be sure the wire doesn't separate from the keyswitch when soldering.</p>
<p>As you move from column to column, it'll be helpful to write the locations of the pins down. We'll use this data to setup the matrix in the future.</p>
<p>When you're done with the columns, start with the rows in the same process, from top to bottom, and write them all down. Again, you can solder anywhere along the row, as long as it's after the diode - soldering before the diode (on the keyswitch side) will cause that row not to work.</p>
<p>As you move along, be sure that the Teensy is staying in place - recutting and soldering the wires is a pain!</p>
<h1 id="page_Getting-Some-Basic-Firmware-Set-Up">Getting Some Basic Firmware Set Up</h1>
<p>From here, you should have a working keyboard once you program a firmware. Before we attach the Teensy permanently to the keyboard, let's quickly get some firmware loaded onto the Teensy so we can test each keyswitch.</p>
<p>To start out, download <a href="https://github.com/qmk/qmk_firmware/" class="Link--external">the firmware</a> - we'll be using my (Jack's) fork of TMK called QMK/Quantum. We'll be doing a lot from the Terminal/command prompt, so get that open, along with a decent text editor like <a href="http://www.sublimetext.com/" class="Link--external">Sublime Text</a>.</p>
<p>The first thing we're going to do is create a new project using the script in the root directory of the firmware. In your terminal, run this command with <code>&lt;project_name&gt;</code> replaced by the name of your project - it'll need to be different from any other project in the <code>keyboards/</code> folder:</p>
<pre><code>    util/new_project.sh &lt;project_name&gt;
</code></pre>
<p>You'll want to navigate to the <code>keyboards/&lt;project_name&gt;/</code> folder by typing, like the print-out from the script specifies:</p>
<pre><code>cd keyboards/&lt;project_name&gt;
</code></pre>
<h3 id="page_section_10"><code>config.h</code></h3>
<p>The first thing you're going to want to modify is the <code>config.h</code> file. Find <code>MATRIX_ROWS</code> and <code>MATRIX_COLS</code> and change their definitions to match the dimensions of your keyboard's matrix.</p>
<p>Farther down are <code>MATRIX_ROW_PINS</code> and <code>MATRIX_COL_PINS</code>. Change their definitions to match how you wired up your matrix (looking from the top of the keyboard, the rows run top-to-bottom and the columns run left-to-right). Likewise, change the definition of <code>UNUSED_PINS</code> to match the pins you did not use (this will save power).</p>
<h3 id="page_section_11"><code>&lt;project_name&gt;.h</code></h3>
<p>The next file you'll want to look at is <code>&lt;project_name&gt;.h</code>. You're going to want to rewrite the <code>KEYMAP</code> definition - the format and syntax here is extremely important, so pay attention to how things are setup. The first half of the definition are considered the arguments - this is the format that you'll be following in your keymap later on, so you'll want to have as many k<em>xy</em> variables here as you do keys. The second half is the part that the firmware actually looks at, and will contain gaps depending on how you wired your matrix.</p>
<p>We'll dive into how this will work with the following example. Say we have a keyboard like this:</p>
<pre><code>    ┌───┬───┬───┐
    │   │   │   │
    ├───┴─┬─┴───┤
    │     │     │
    └─────┴─────┘
</code></pre>
<p>This can be described by saying the top row is 3 1u keys, and the bottom row is 2 1.5u keys. The difference between the two rows is important, because the bottom row has an unused column spot (3 v 2). Let's say that this is how we wired the columns:</p>
<pre><code>    ┌───┬───┬───┐
    │ ┋ │ ┋ │ ┋ │
    ├─┋─┴─┬─┴─┋─┤
    │ ┋   │   ┋ │
    └─────┴─────┘
</code></pre>
<p>The middle column is unused on the bottom row in this example. Our <code>KEYMAP</code> definition would look like this:</p>
<pre><code>    #define KEYMAP( \
        k00, k01, k02, \
          k10,  k11,   \
    ) \
    { \
        { k00, k01,   k02 }, \
        { k10, KC_NO, k11 }, \
    }
</code></pre>
<p>Notice how the top half is spaced to resemble our physical layout - this helps us understand which keys are associated with which columns. The bottom half uses the keycode <code>KC_NO</code> where there is no keyswitch wired in. It's easiest to keep the bottom half aligned in a grid to help us make sense of how the firmware actually sees the wiring.</p>
<p>Let's say that instead, we wired our keyboard like this (a fair thing to do):</p>
<pre><code>    ┌───┬───┬───┐
    │ ┋ │  ┋│ ┋ │
    ├─┋─┴─┬┋┴───┤
    │ ┋   │┋    │
    └─────┴─────┘
</code></pre>
<p>This would require our <code>KEYMAP</code> definition to look like this:</p>
<pre><code>    #define KEYMAP( \
        k00, k01, k02, \
          k10,  k11,   \
    ) \
    { \
        { k00, k01, k02   }, \
        { k10, k11, KC_NO }, \
    }
</code></pre>
<p>Notice how the <code>k11</code> and <code>KC_NO</code> switched places to represent the wiring, and the unused final column on the bottom row. Sometimes it'll make more sense to put a keyswitch on a particular column, but in the end, it won't matter, as long as all of them are accounted for. You can use this process to write out the <code>KEYMAP</code> for your entire keyboard - be sure to remember that your keyboard is actually backwards when looking at the underside of it.</p>
<h3 id="page_section_12"><code>keymaps/&lt;variant&gt;/default.c</code></h3>
<p>This is the actual keymap for your keyboard, and the main place you'll make changes as you perfect your layout. <code>default.c</code> is the file that gets pull by default when typing <code>make</code>, but you can make other files as well, and specify them by typing <code>make handwired/&lt;keyboard&gt;:&lt;variant&gt;</code>, which will pull <code>keymaps/&lt;variant&gt;/keymap.c</code>.</p>
<p>The basis of a keymap is its layers - by default, layer 0 is active. You can activate other layers, the highest of which will be referenced first. Let's start with our base layer.</p>
<p>Using our previous example, let's say we want to create the following layout:</p>
<pre><code>    ┌───┬───┬───┐
    │ A │ 1 │ H │
    ├───┴─┬─┴───┤
    │ TAB │ SPC │
    └─────┴─────┘
</code></pre>
<p>This can be accomplished by using the following <code>keymaps</code> definition:</p>
<pre><code>const uint16_t PROGMEM keymaps[][MATRIX_ROWS][MATRIX_COLS] = {
    [0] = KEYMAP( /* Base */
      KC_A,  KC_1,  KC_H, \
        KC_TAB,  KC_SPC   \
    ),
};
</code></pre>
<p>Note that the layout of the keycodes is similar to the physical layout of our keyboard - this make it much easier to see what's going on. A lot of the keycodes should be fairly obvious, but for a full list of them, check out <a href="../Keycodes/index.html">Keycodes</a> - there are also a lot of aliases to condense your keymap file.</p>
<p>It's also important to use the <code>KEYMAP</code> function we defined earlier - this is what allows the firmware to associate our intended readable keymap with the actual wiring.</p>
<h2 id="page_Compiling-Your-Firmware">Compiling Your Firmware</h2>
<p>After you've written out your entire keymap, you're ready to get the firmware compiled and onto your Teensy. Before compiling, you'll need to get your <a href="../Getting_Started/index.html">development environment set-up</a> - you can skip the dfu-programmer instructions, but you'll need to download and install the <a href="https://www.pjrc.com/teensy/loader.html" class="Link--external">Teensy Loader</a> to get the firmware on your Teensy.</p>
<p>Once everything is installed, running <code>make</code> in the terminal should get you some output, and eventually a <code>&lt;project_name&gt;.hex</code> file in that folder. If you're having trouble with this step, see the end of the guide for the trouble-shooting section.</p>
<p>Once you have your <code>&lt;project_name&gt;.hex</code> file, open up the Teensy loader application, and click the file icon. From here, navigate to your <code>QMK/keyboards/&lt;project_name&gt;/</code> folder, and select the <code>&lt;project_name&gt;.hex</code> file. Plug in your keyboard and press the button on the Teensy - you should see the LED on the device turn off once you do. The Teensy Loader app will change a little, and the buttons should be clickable - click the download button (down arrow), and then the reset button (right arrow), and your keyboard should be ready to go!</p>
<h2 id="page_Testing-Your-Firmware">Testing Your Firmware</h2>
<p>Carefully flip your keyboard over, open up a new text document, and try typing - you should get the characters that you put into your keymap. Test each key, and note the ones that aren't working. Here's a quick trouble-shooting guide for non-working keys:</p>
<ol start="0">
<li>Flip the keyboard back over and short the keyswitch's contacts with a piece wire - this will eliminate the possibility of the keyswitch being bad and needing to be replaced.</li>
<li>Check the solder points on the keyswitch - these need to be plump and whole. If you touch it with a moderate amount of force and it comes apart, it's not strong enough.</li>
<li>Check the solder joints on the diode - if the diode is loose, part of your row may register, while the other may not.</li>
<li>Check the solder joints on the columns - if your column wiring is loose, part or all of the column may not work.</li>
<li>Check the solder joints on both sides of the wires going to/from the Teensy - the wires need to be fully soldered and connect to both sides.</li>
<li>Check the &lt;project_name&gt;.h file for errors and incorrectly placed <code>KC_NO</code>s - if you're unsure where they should be, instead duplicate a k<em>xy</em> variable.</li>
<li>Check to make sure you actually compiled the firmware and flashed the Teensy correctly. Unless you got error messages in the terminal, or a pop-up during flashing, you probably did everything correctly.</li>
</ol>
<p>If you've done all of these things, keep in mind that sometimes you might have had multiple things affecting the keyswitch, so it doesn't hurt to test the keyswitch by shorting it out at the end.</p>
<h1 id="page_Securing-the-Teensy-Finishing-Your-Hardware-Getting-Fancier-Firmware">Securing the Teensy, Finishing Your Hardware, Getting Fancier Firmware</h1>
<p>Now that you have a working board, it's time to get things in their permanent positions. I've often used liberal amounts of hot glue to secure and insulate things, so if that's your style, start spreading that stuff like butter. Otherwise, double-sided tape is always an elegant solution, and electrical tape is a distant second. Due to the nature of these builds, a lot of this part is up to you and how you planned (or didn't plan) things out.</p>
<p>There are a lot of possibilities inside the firmware - explore <a href="http://docs.qmk.fm" class="Link--external">docs.qmk.fm</a> for a full feature list, and dive into the different project (Planck, Clueboard, Ergodox EZ, etc) to see how people use all of them. You can always stop by <a href="http://reddit.com/r/olkb" class="Link--external">the OLKB subreddit for help!</a></p>
    </div>

        <nav>
        <ul class="Pager">
            <li class=Pager--prev><a href="../For_Makers_And_Modders/index.html">Previous</a></li>            <li class=Pager--next><a href="../For_Makers_And_Modders/ISP_Flashing_Guide.html">Next</a></li>        </ul>
    </nav>
    </article>

            </div>
        </div>
    </div>
</div>

    
    <!-- JS -->
    <script src="../themes/daux/js/jquery-1.11.3.min.js"></script><script src="../themes/daux/js/highlight.pack.js"></script><script src="../themes/daux/js/daux.js"></script>
            <!-- Tipue Search -->
        <script type="text/javascript" src="../tipuesearch/tipuesearch.js"></script>

        <script>
            window.onunload = function(){}; // force $(document).ready to be called on back/forward navigation in firefox
            $(function() {
                tipuesearch({
                    'base_url': '../'
                });
            });
        </script>
    
</body>
</html>
